# AGENTS.md

- You are a senior TypeScript functional programmer with deep expertise in TanStack Router/Start, Cloudflare Workers with Vite, Shadcn UI with Base UI, and Tailwind CSS 4.0.
- Do not generate comments unless explicitly and specifically instructed.
- Do not remove existing comments unless explicitly and specifically instructed.

## Project

- `tanstack-sandbox3` is a TanStack Router + TanStack Start application with shadcn/ui components (Base UI variant), TypeScript, Tailwind CSS v4, and Cloudflare Workers deployment.
- TanStack Router route modules are in `src/routes/` and use file route conventions.
- **Stack**: React 19, TanStack Router/Start, Base UI, Tailwind CSS v4, Vitest, ESLint, Prettier, pnpm
- **Refs**: Downloaded source code of libraries are in `refs/` for reference.
  - crrbuis is a saas template using cloudflare, react router, better auth, shadcn with base ui. We want to bring similar features to this project using tanstack router and tanstack start.

### Reference Docs Locations

- **TanStack Form**: `refs/tan-form/docs/` (Markdown files)
- **Shadcn UI**: `refs/shadcn/apps/v4/content/docs/` (MDX files)
- **Base UI**: `refs/base-ui/docs/src/app/(docs)/(content)/react/` (MDX files in subdirs)
- **Better Auth**: `refs/better-auth/docs/content/docs/` (MDX files - plugins, integrations, adapters, guides, concepts, authentication, reference)
- **TanStack Start**: `refs/tan-start/docs/` (MDX files - start/framework/react, start/framework/solid)
- **TanStack Router**: `refs/tan-router/docs/` (MDX files - router/framework/react, router/framework/solid)

## Build/Lint/Test Commands

### Development
```bash
pnpm dev                # Start dev server on port 3000
pnpm build              # Production build
pnpm serve              # Preview production build
pnpm preview            # Build and preview
```

### Testing
```bash
pnpm test               # Run all tests with Vitest
# Note: No test files exist yet. Create tests as *.test.ts or *.test.tsx
# For single test file: pnpm test path/to/file.test.tsx
# For watch mode: pnpm vitest (or add script: "test:watch": "vitest")
```

### Code Quality
```bash
pnpm lint               # Run ESLint
pnpm typecheck          # TypeScript type checking (includes wrangler types generation)
pnpm format             # Format code with Prettier
pnpm format:check       # Check formatting without writing
```

### Deployment
```bash
pnpm cf-typegen         # Generate Cloudflare Worker types
```

## TypeScript Guidelines

- Always follow functional programming principles
- Use interfaces for data structures and type definitions
- Prefer immutable data (const, readonly)
- Use optional chaining (?.) and nullish coalescing (??) operators
- **Do not add any comments to generated code.** Rely on clear naming, concise logic, and functional composition to ensure code is self-documenting.
- Employ a concise and dense coding style. Prefer inlining expressions, function composition (e.g., piping or chaining), and direct returns over using intermediate variables, unless an intermediate variable is essential for clarity in exceptionally complex expressions or to avoid redundant computations.
- For function arguments, prefer destructuring directly in the function signature if the destructuring is short and shallow (e.g., `({ data: { value }, otherArg })`). For more complex or deeper destructuring, or if the parent argument object is also needed, destructuring in the function body is acceptable.
- Prefer namespace imports for large libraries.
- **Strict mode enabled**: All strict TypeScript checks are on
- **No unused variables/parameters**: Prefix with `_` if intentionally unused
- **Type imports**: Use `import type` for type-only imports when possible
- **Path aliases**: Use `@/*` for `src/*` imports (configured in tsconfig.json)

```ts
import type { Stripe as StripeTypes } from "stripe";
import * as React from "react";
import * as TanStackRouter from "@tanstack/react-router";
import * as TanStackStart from "@tanstack/react-start";
import * as Stripe from "stripe";
import * as z from "zod";
```

## SQL Guidelines

- Using sqlite with Cloudflare D1.
- Use lowercase for all sql keywords.
- Use positional parameter placeholders.

### Type generation for Cloudflare
Run `pnpm cf-typegen` to regenerate `worker-configuration.d.ts` after changing wrangler.jsonc bindings.

## Do Not Edit

The following are auto-generated or externally managed:
- `src/routeTree.gen.ts` - Generated by TanStack Router
- `worker-configuration.d.ts` - Generated by Wrangler
- `refs/` directory - External reference code (excluded from TypeScript/linting)

Always use context7 when I need code generation, setup or configuration steps, or library/API documentation. This means you should automatically use the Context7 MCP tool to resolve library id and get library docs without me having to explicitly instruct.
